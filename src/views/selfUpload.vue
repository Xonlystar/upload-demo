<template>
  <div>
    <upload-img id="upload" ref="uploadImg" @getUrl="uploadCallback" :hidden="true"/>
    <input type="file" ref="selectPic" @change="selectPic">
    <button @click="b64Upload">上传base64图片</button>
    <div v-if="img" >
      <img class="img-result" :src="img"/>
    </div>
  </div>
</template>

<script>
import UploadImg from '@/components/UploadImg'
export default {
  name: 'uploadLocal',
  components: {
    UploadImg
  },
  data () {
    return {
      img: ''
    }
  },
  methods: {
    uploadCallback (res) {
      this.img = res.url
    },
    selectPic () {
      let file = this.$refs.selectPic.files[0]
      console.log(file)
      let uploader = this.$refs.uploadImg.uploader
      console.log(uploader)
      uploader.addFile(file)
    },
    b64Upload () {
      let base64Str = 'data:image/x-icon;base64,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'
      let file = this.getFile(base64Str, new Date().getTime() + '.png')
      let uploader = this.$refs.uploadImg.uploader
      uploader.addFile(file)
    },
    getFile (dataurl, filename) {
      let arr = dataurl.split(',')
      let mime = arr[0].match(/:(.*?);/)[1]
      let bstr = atob(arr[1])
      let n = bstr.length
      let u8arr = new Uint8Array(n)
      while (n--) {
        u8arr[n] = bstr.charCodeAt(n)
      }
      return new File([u8arr], filename, { type: mime })
    }
  }
}
</script>

<style scoped>

</style>
